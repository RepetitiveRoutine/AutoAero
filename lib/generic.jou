;-------------CMT MAP SCRIPT
;------PURPOSE: runs 40, 60, 80kmh symmetry sims and saves forces and COP to files for processing
;------AUTHER: Cameron Gee
;------DATE: 20/07/2019
;------HOWTO: Modify all definitions of "study" and "filename" that appear within the "CHANGE THIS SECTION" sections
;------------ Other paramaers can be changed by people that know what they are doing ;)
;------------ To add a new sim copy the LAST paramater block and remove the exit part so it only appears at the end.
;------CHANGELOG: 22/07/19 - Added 'yes' to data qauntities as it prompts if already defined.
;--------------------------- Added downforce and drag to printout so stability of value can be determined post sim.
;--------------------------- Remove Wall, Ground, Symmetry from force reports
:---------------- 25/07/19 - Fixed tyre boundary condition (tyrefront was defined twice and tyrerear was undefined)
;---------------- 28/07/19 - Commented out mesh improvement steps and added smooth due to bad elements surviving
;---------------- 07/07/20 - Reduced itterations from 500 to 350
;---------------- 12/10/20 - Now exports images of report plots to file directory
;---------------- 12/10/20 - fixed case/data file export command to work in ANSYS 2020 R2
;--------TO DO:
;---------- ADD F1, F2, F3 AND R1, R2, R3 AND SWANGS TO SPACECLAIM AND FORCE REPORTS
;---------- ADD FORCE FULL PRINTOUT TO TRANSCRIPT TO ANALYSIS ALL BODIES (WHEELS&SUSPENSIONSTUFF)
;---------- CONFIRM FORCE PLOTS DURING SIM ARE ADDED TO TRANSCRIPT TO CHECK STABILITY
;---------- WRITE PYTHON SCRIPT TO SCRAPE ALL THE IMPORTANT INFORMATION!!!


;---------------MESHING---------------

;--CHANGE THIS SECTION BELOW --
;FSAE-Test script
(define study "SIM_NUM")
(define fileName "SCDOC")
(define factor 1)

;;transcript
(ti-menu-load-string (format #f "file start-transcript ~a-~a-~02d.trn" fileName study factor))

;Name selection : car_frontwing, car_rearwing, car_suspension, car_tyrefront, car_tyrerear, car_nosecone, car_system, car_undertray
;Volume selection : enclosure, boi-near, boi-wake, boi-fw, boi-rw, boi-diff
;Name selection on enclosuer : inlet, outlet, wall, ground, symmetry

;;define global parameters
(define global-min 1)
(define global-max 600)
(define global-growth-rate 1.2)

;;define proximity parameters
(define min-prox-size 1)
(define max-prox-size 4)
(define prox-gap-cell 4)

;;define curvature aero parameters
(define min-face-size-aero 1)
(define max-face-size-aero 10)
(define norm-angle 18)

;;define curvature other parameters
(define min-face-size-other 1)
(define max-face-size-other 20)
(define norm-angle 18)

;;define boi parameters
(define boi-aero 10)
(define boi-near 100)
(define boi-wake 400)

;;define inflation parameters - FW
(define first-layer-height-fw 1.202)
(define number-of-layers-fw 6)
(define last-percent-fw 35)

;;define inflation parameters - RW
(define first-layer-height-rw 1.248)
(define number-of-layers-rw 7)
(define last-percent-rw 35)

;;define inflation parameters - DIFF
(define first-layer-height-diff 1.386)
(define number-of-layers-diff 11)
(define last-percent-diff 35)

;------- FLUENT MESHING -------

;beta functions
/beta-feature-aMAPess yes yes

;;import cad faceting
file import cad-options save-PMDB? yes
(ti-menu-load-string (format #f "file import cad , ~a.scdoc , , , mm" fileName))

;;define global size-functions
/size-functions set-global-controls global-min global-max global-growth-rate

;;scope boi
/scoped-sizing create boi-aero boi object-faces-and-edges yes no "boi-diff:boi-diff-solid boi-fw:boi-fw-solid boi-rw:boi-rw-solid " boi-aero global-growth-rate
/scoped-sizing create boi-near boi object-faces-and-edges yes no boi-n* boi-near global-growth-rate
/scoped-sizing create boi-wake boi object-faces-and-edges yes no boi-w* boi-wake global-growth-rate


;;create proximity sizing
/scoped-sizing create prox-all proximity edge-zone yes no "car_frontwing:feature car_frontwing:symmetry:enclosure:enclosure-enclosure:feature car_nosecone:car_sidepods:enclosure:enclosure-enclosure:feature car_nosecone:car_sidepods:enclosure:enclosure-enclosure:feature.1 car_nosecone:car_suspension:enclosure:enclosure-enclosure:feature car_nosecone:car_suspension:enclosure:enclosure-enclosure:feature.1 car_nosecone:car_system:enclosure:enclosure-enclosure:feature car_nosecone:feature car_nosecone:symmetry:enclosure:enclosure-enclosure:feature car_nosecone:symmetry:enclosure:enclosure-enclosure:feature.1 car_rearwing:feature car_rearwing:symmetry:enclosure:enclosure-enclosure:feature car_sidepods:feature car_suspension:car_system:enclosure:enclosure-enclosure:feature car_suspension:feature car_system:feature car_system:symmetry:enclosure:enclosure-enclosure:feature car_system:symmetry:enclosure:enclosure-enclosure:feature.1 car_tyrefront:ground:enclosure:enclosure-enclosure:feature car_tyrerear:ground:enclosure:enclosure-enclosure:feature car_undertray:feature car_undertray:symmetry:enclosure:enclosure-enclosure:feature " min-prox-size max-prox-size global-growth-rate prox-gap-cell

;;create curvature aero sizing
/scoped-sizing create curv-aero curvature face-zone yes no "car_frontwing car_rearwing car_undertray " min-face-size-aero max-face-size-aero global-growth-rate norm-angle

;;create curvature other sizing
/scoped-sizing create curv-other curvature face-zone yes no "car_nosecone car_sidepods car_suspension car_system car_tyrefront car_tyrerear " min-face-size-other max-face-size-other global-growth-rate norm-angle


;;compute size field
/scoped-sizing compute
(ti-menu-load-string (format #f "file write-size-field ~a-~02d.sizing" fileName factor))

;re-import
/file import cad-options save-PMDB? no
(ti-menu-load-string (format #f "file import cad-options tessellation cfd-surface-mesh yes ~a-~02d.sizing.sf" fileName factor))
(ti-menu-load-string (format #f "file import cad , ~a.scdoc.pmdb , , , , mm yes" fileName))

;;diagnostics quality improve
/diagnostics quality general-improve objects (en*) skewness 0.95 40 30 yes
/diagnostics quality general-improve objects (en*) skewness 0.9 40 30 yes
/diagnostics quality general-improve objects (en*) skewness 0.8 40 30 yes
/diagnostics quality general-improve objects (en*) skewness 0.7 40 30 yes
;/diagnostics quality general-improve objects (en*) skewness 0.6 40 30 yes
;/diagnostics quality general-improve objects (en*) skewness 0.5 40 30 yes

/diagnostics quality collapse objects (en*) skewness 0.99 40 30 no
/diagnostics quality collapse objects (en*) skewness 0.98 40 30 no
/diagnostics quality collapse objects (en*) skewness 0.97 40 30 no
/diagnostics quality collapse objects (en*) skewness 0.96 40 30 no
/diagnostics quality collapse objects (en*) skewness 0.95 40 30 no
;/diagnostics quality collapse objects (en*) skewness 0.9 40 30 no
;/diagnostics quality collapse objects (en*) skewness 0.85 40 30 no

/diagnostics quality general-improve objects (en*) skewness 0.95 40 30 yes
/diagnostics quality general-improve objects (en*) skewness 0.9 40 30 yes
/diagnostics quality general-improve objects (en*) skewness 0.8 40 30 yes
/diagnostics quality general-improve objects (en*) skewness 0.7 40 30 yes
;/diagnostics quality general-improve objects (en*) skewness 0.6 40 30 yes
;/diagnostics quality general-improve objects (en*) skewness 0.5 40 30 yes

/diagnostics quality smooth objects (en*) 10 yes

/diagnostics quality general-improve objects (en*) skewness 0.95 40 30 yes
/diagnostics quality general-improve objects (en*) skewness 0.9 40 30 yes
/diagnostics quality general-improve objects (en*) skewness 0.8 40 30 yes
/diagnostics quality general-improve objects (en*) skewness 0.7 40 30 yes
;/diagnostics quality general-improve objects (en*) skewness 0.6 40 30 yes
;/diagnostics quality general-improve objects (en*) skewness 0.5 40 30 yes

;;volume mesh
/objects volumetric-regions compute en* no
/objects vol-reg change-type en* (en*) fluid

;;create volume mesh
/mesh poly controls cell-sizing size-field
/mesh scoped-prisms create fw-prism last-ratio first-layer-height-fw number-of-layers-fw last-percent-fw enclosure:enclosure-enclosure fluid-regions selected-face-zones car_frontwing
/mesh scoped-prisms create rw-prism last-ratio first-layer-height-rw number-of-layers-rw last-percent-rw enclosure:enclosure-enclosure fluid-regions selected-face-zones car_rearwing
/mesh scoped-prisms create diff-prism last-ratio first-layer-height-diff number-of-layers-diff last-percent-diff enclosure:enclosure-enclosure fluid-regions selected-face-zones car_undertray

;meshing poly-hexcore
/mesh auto-mesh en* yes scoped pyramids poly-hexcore yes

;;volume mesh diagnostics
/mesh modify auto-node-move (*) (*) 0.99 50 120 yes 10
/mesh modify auto-node-move (*) (*) 0.98 50 120 yes 10
/mesh modify auto-node-move (*) (*) 0.96 50 120 yes 10
/mesh modify auto-node-move (*) (*) 0.94 50 120 yes 10
/mesh modify auto-node-move (*) (*) 0.92 50 120 yes 10
/mesh modify auto-node-move (*) (*) 0.90 50 120 yes 10

;;scale down
/mesh manage scale-model 0.001 0.001 0.001

;;prepare mesh to solve
/mesh prepare-for-solve yes

;;save mesh (not required)
(ti-menu-load-string (format #f "file write-mesh mesh-~a-~a-~02d.msh.gz" fileName study factor))

;;switch to solution
/switch-to-solution-mode yes yes

;------- FLUENT SOLVER -------

;;--------40KmH---------------
;;------CHANGE SECTION BELOW-------

;;define other
(define study "SIM_NUM")
(define fileName "-11.11MS")

;;define variables
(define air-speed 11.11)
(define number-of-iterate 350)
(define factor 1)

;wheel paramaters
;(w=v/r)
(define radius 0.228)
(define wheel-rot-speed (/ air-speed radius))

;front wheel
(define x-origin-tyrefront -0.732)
(define y-origin-tyrefront 0.225)
(define z-origin-tyrefront 0)

;rear wheel
(define x-origin-tyrerear -0.688)
(define y-origin-tyrerear 0.225)
(define z-origin-tyrerear -1.575)

;axis
(define x-axis-rot 1)
(define y-axis-rot 0)
(define z-axis-rot 0)
;;model type
/define models viscous kw-sst? yes
/define models viscous curvature-correction? yes

;;message from fluent
/display set nodewt-based-interp? no

;;define zone types
/define boundary-conditions modify-zones zone-type enclosure fluid
/define boundary-conditions modify-zones zone-type inlet velocity-inlet
/define boundary-conditions modify-zones zone-type outlet pressure-outlet
/define boundary-conditions modify-zones zone-type symmetry symmetry

;;define boundary conditions
/define boundary-conditions velocity-inlet inlet no no yes yes no air-speed no 0 no no yes 5 10
/define boundary-conditions wall ground yes motion-bc-moving , , no , , air-speed 0 0 -1 , , , , ,
/define boundary-conditions wall wall yes motion-bc-moving , , no , , air-speed 0 0 -1 , , , , ,
/define boundary-conditions pressure-outlet outlet yes no 0 no yes no no yes 5 10 yes no yes no
/define boundary-conditions wall car_tyrefront yes motion-bc-moving no no no yes no no 0 no 0.5 no wheel-rot-speed x-origin-tyrefront y-origin-tyrefront z-origin-tyrefront x-axis-rot y-axis-rot z-axis-rot
/define boundary-conditions wall car_tyrerear yes motion-bc-moving no no no yes no no 0 no 0.5 no wheel-rot-speed x-origin-tyrerear y-origin-tyrerear z-origin-tyrerear x-axis-rot y-axis-rot z-axis-rot

;;set methods conditions
/solve set p-v-coupling 24
/solve set warped-face-gradient-correction enable? yes yes
/solve set high-order-term-relaxation enable yes


;;drag and lift reports
solve/report-definitions/add car-lift force force-vector 0 1 0 thread-names (car_frontwing car_rearwing car_suspension car_tyrefront car_tyrerear car_system car_nosecone car_undertray) quit
solve/report-definitions/add car-drag force force-vector 0 0 -1 thread-names (car_frontwing car_rearwing car_suspension car_tyrefront car_tyrerear car_system car_nosecone car_undertray) quit
solve/report-definitions/add fw-lift force force-vector 0 1 0 thread-names (car_frontwing) quit
solve/report-definitions/add fw-drag force force-vector 0 0 -1 thread-names (car_frontwing) quit
solve/report-definitions/add rw-lift force force-vector 0 1 0 thread-names (car_rearwing) quit
solve/report-definitions/add rw-drag force force-vector 0 0 -1 thread-names (car_rearwing) quit
solve/report-definitions/add diff-lift force force-vector 0 1 0 thread-names (car_undertray) quit
solve/report-definitions/add diff-drag force force-vector 0 0 -1 thread-names (car_undertray) quit

;;add force plots to console for convergance stability confirmation
//solve/report-plots/add lift-drag report-defs (car-lift car-drag fw-lift fw-drag rw-lift rw-drag diff-lift diff-drag) title "Lift & Drag" y-label "Force" print? yes quit

;;save reports to csv
(ti-menu-load-string (format #f "/solve report-files edit straightline-force file-name report-~a-~a-~02d.csv" fileName study factor))

;;write case before solve just in case
;;(ti-menu-load-string (format #f "file write-case before-solved-~a-~a-~02d.cas.gz" fileName study factor))

;;initialize
/solve initialize hyb-initialization

;;include data qauntities - no way to seelct all so listed all here :(
file data-file-options abs-angular-coordinate mesh-x-velocity absolute-pressure mesh-y-velocity adaption-curvature mesh-z-velocity adaption-function orthogonal-quality adaption-iso-value partition-neighbors adaption-space-gradient pressure angular-coordinate pressure-coefficient axial-coordinate production-of-k axial-velocity radial-coordinate boundary-cell-dist radial-velocity boundary-normal-dist rel-tangential-velocity boundary-volume-dist rel-total-pressure cell-children rel-velocity-magnitude cell-element-type relative-velocity-angle cell-equiangle-skew relative-x-velocity cell-equivolume-skew relative-y-velocity cell-id relative-z-velocity cell-partition-active skin-friction-coef cell-partition-stored strain-rate-mag cell-refine-level tangential-velocity cell-reynolds-number total-pressure cell-surface-area turb-diss-rate cell-type turb-intensity cell-volume turb-kinetic-energy cell-volume-change turb-reynolds-number-rey cell-wall-distance velocity-angle cell-warp velocity-magnitude cell-weight viscosity-eff cell-zone viscosity-lam curv-corr-fr viscosity-ratio density viscosity-turb density-all vorticity-mag dp-dx wall-shear dp-dy wall-temp-in-surf dp-dz wall-temp-out-surf dx-velocity-dx x-coordinate dx-velocity-dy x-face-area dx-velocity-dz x-velocity dy-velocity-dx x-vorticity dy-velocity-dy x-wall-shear dy-velocity-dz y-coordinate dynamic-pressure y-face-area dz-velocity-dx y-plus dz-velocity-dy y-star dz-velocity-dz y-velocity existing-value y-vorticity face-area-magnitude y-wall-shear face-handedness z-coordinate helicity z-face-area interface-overlap-fraction z-velocity mark-poor-elements z-vorticity mass-imbalance z-wall-shear q

;;solve
/solve iterate number-of-iterate


;;lift drag COP force reports for all because why not
(ti-menu-load-string (format #f "report forces wall-forces no car_frontwing car_rearwing car_undertray car_nosecone car_suspension car_system car_tyrefront car_tyrerear , 0 -1 0 yes downforce-~a-~a-~02d.csv" fileName study factor))
(ti-menu-load-string (format #f "report forces wall-forces no car_frontwing car_rearwing car_undertray car_nosecone car_suspension car_system car_tyrefront car_tyrerear , 0 0 -1 yes drag-~a-~a-~02d.csv" fileName study factor))
(ti-menu-load-string (format #f "report forces pressure-center no car_frontwing car_rearwing car_undertray car_nosecone car_suspension car_system car_tyrefront car_tyrerear , no yes 0 yes COP-Y-~a-~a~02d.csv"fileName study factor))

;----------SET SCREENSHOT OPTIONS----------
//display/set/colors/color-scheme gray-gradient
display/set/picture/use-window-resolution? no
display/set/picture/x-resolution 1920
display/set/picture/y-resolution 1080
display/set/picture/invert-background? no
;
;----------SAVE REPORT PLOT WINDOWS----------
//display/set-window 1
display/save-picture "[IMG] 00 - Scaled Residuals - 40Kmh.jpg"
display/set-window 2
display/save-picture "[IMG] 01 - Lift and Drag - 40Kmh.jpg"

;summary of sim
(ti-menu-load-string (format #f "report summary yes fluent-solving-~a-~a-~02d-report.csv" fileName study factor))
/report system proc-stats

;write case and data files
/file/export/cdat-for-cfd-post-&-ensight solved-40KmH (*) (*) (*) yes yes



;;------60KmH-------

;;------CHANGE SECTION BELOW---

;;define other
(define study "SIM_NUM")
(define fileName "-16.67MS")

;;define variables
(define air-speed 16.67)
(define number-of-iterate 350)
(define factor 1)

;wheel paramaters
;(w=v/r)
(define radius 0.228)
(define wheel-rot-speed (/ air-speed radius))

;front wheel
(define x-origin-tyrefront -0.732)
(define y-origin-tyrefront 0.225)
(define z-origin-tyrefront 0)

;rear wheel
(define x-origin-tyrerear -0.688)
(define y-origin-tyrerear 0.225)
(define z-origin-tyrerear -1.575)

;axis
(define x-axis-rot 1)
(define y-axis-rot 0)
(define z-axis-rot 0)

;------- CHANGE THIS SECTION ABOVE -------

;;define boundary conditions
/define boundary-conditions velocity-inlet inlet no no yes yes no air-speed no 0 no no yes 5 10
/define boundary-conditions wall ground yes motion-bc-moving , , no , , air-speed 0 0 -1 , , , , ,
/define boundary-conditions wall wall yes motion-bc-moving , , no , , air-speed 0 0 -1 , , , , ,
/define boundary-conditions pressure-outlet outlet yes no 0 no yes no no yes 5 10 yes no yes no
/define boundary-conditions wall car_tyrefront yes motion-bc-moving no no no yes no no 0 no 0.5 no wheel-rot-speed x-origin-tyrefront y-origin-tyrefront z-origin-tyrefront x-axis-rot y-axis-rot z-axis-rot
/define boundary-conditions wall car_tyrerear yes motion-bc-moving no no no yes no no 0 no 0.5 no wheel-rot-speed x-origin-tyrerear y-origin-tyrerear z-origin-tyrerear x-axis-rot y-axis-rot z-axis-rot

;;save reports to csv
(ti-menu-load-string (format #f "/solve report-files edit straightline-force file-name report-~a-~a-~02d.csv" fileName study factor))

;;write case before solve just in case - not for iteration we already have a backup
;;(ti-menu-load-string (format #f "file write-case before-solved-~a-~a-~02d.cas.gz" fileName study factor))

;;initialize
/solve initialize hyb-initialization

;;include data qauntities - no way to seelct all so listed all here :(
file data-file-options yes abs-angular-coordinate mesh-x-velocity absolute-pressure mesh-y-velocity adaption-curvature mesh-z-velocity adaption-function orthogonal-quality adaption-iso-value partition-neighbors adaption-space-gradient pressure angular-coordinate pressure-coefficient axial-coordinate production-of-k axial-velocity radial-coordinate boundary-cell-dist radial-velocity boundary-normal-dist rel-tangential-velocity boundary-volume-dist rel-total-pressure cell-children rel-velocity-magnitude cell-element-type relative-velocity-angle cell-equiangle-skew relative-x-velocity cell-equivolume-skew relative-y-velocity cell-id relative-z-velocity cell-partition-active skin-friction-coef cell-partition-stored strain-rate-mag cell-refine-level tangential-velocity cell-reynolds-number total-pressure cell-surface-area turb-diss-rate cell-type turb-intensity cell-volume turb-kinetic-energy cell-volume-change turb-reynolds-number-rey cell-wall-distance velocity-angle cell-warp velocity-magnitude cell-weight viscosity-eff cell-zone viscosity-lam curv-corr-fr viscosity-ratio density viscosity-turb density-all vorticity-mag dp-dx wall-shear dp-dy wall-temp-in-surf dp-dz wall-temp-out-surf dx-velocity-dx x-coordinate dx-velocity-dy x-face-area dx-velocity-dz x-velocity dy-velocity-dx x-vorticity dy-velocity-dy x-wall-shear dy-velocity-dz y-coordinate dynamic-pressure y-face-area dz-velocity-dx y-plus dz-velocity-dy y-star dz-velocity-dz y-velocity existing-value y-vorticity face-area-magnitude y-wall-shear face-handedness z-coordinate helicity z-face-area interface-overlap-fraction z-velocity mark-poor-elements z-vorticity mass-imbalance z-wall-shear q

;;solve
/solve iterate number-of-iterate

;;lift drag COP force reports for all because why not
(ti-menu-load-string (format #f "report forces wall-forces no car_frontwing car_rearwing car_undertray car_nosecone car_suspension car_system car_tyrefront car_tyrerear , 0 -1 0 yes downforce-~a-~a-~02d.csv" fileName study factor))
(ti-menu-load-string (format #f "report forces wall-forces no car_frontwing car_rearwing car_undertray car_nosecone car_suspension car_system car_tyrefront car_tyrerear , 0 0 -1 yes drag-~a-~a-~02d.csv" fileName study factor))
(ti-menu-load-string (format #f "report forces pressure-center no car_frontwing car_rearwing car_undertray car_nosecone car_suspension car_system car_tyrefront car_tyrerear , no yes 0 yes COP-Y-~a-~a~02d.csv"fileName study factor))

;----------SET SCREENSHOT OPTIONS----------
//display/set/colors/color-scheme gray-gradient
display/set/picture/use-window-resolution? no
display/set/picture/x-resolution 1920
display/set/picture/y-resolution 1080
display/set/picture/invert-background? no
;
;----------SAVE REPORT PLOT WINDOWS----------
//display/set-window 1
display/save-picture "[IMG] 00 - Scaled Residuals - 60Kmh.jpg"
display/set-window 2
display/save-picture "[IMG] 01 - Lift and Drag - 60Kmh.jpg"

;summary of sim
(ti-menu-load-string (format #f "report summary yes fluent-solving-~a-~a-~02d-report.csv" fileName study factor))
/report system proc-stats

;write case and data files
/file/export/cdat-for-cfd-post-&-ensight solved-60KmH (*) (*) (*) yes yes



;;------80KmH-------

;;------CHANGE SECTION BELOW---

;;define other
(define study "SIM_NUM")
(define fileName "-22.22MS")

;;define variables
(define air-speed 22.22)
(define number-of-iterate 350)
(define factor 1)

;wheel paramaters
;(w=v/r)
(define radius 0.228)
(define wheel-rot-speed (/ air-speed radius))

;front wheel
(define x-origin-tyrefront -0.732)
(define y-origin-tyrefront 0.225)
(define z-origin-tyrefront 0)

;rear wheel
(define x-origin-tyrerear -0.688)
(define y-origin-tyrerear 0.225)
(define z-origin-tyrerear -1.575)

;axis
(define x-axis-rot 1)
(define y-axis-rot 0)
(define z-axis-rot 0)

;------- CHANGE THIS SECTION ABOVE -------

;;define boundary conditions
/define boundary-conditions velocity-inlet inlet no no yes yes no air-speed no 0 no no yes 5 10
/define boundary-conditions wall ground yes motion-bc-moving , , no , , air-speed 0 0 -1 , , , , ,
/define boundary-conditions wall wall yes motion-bc-moving , , no , , air-speed 0 0 -1 , , , , ,
/define boundary-conditions pressure-outlet outlet yes no 0 no yes no no yes 5 10 yes no yes no
/define boundary-conditions wall car_tyrefront yes motion-bc-moving no no no yes no no 0 no 0.5 no wheel-rot-speed x-origin-tyrefront y-origin-tyrefront z-origin-tyrefront x-axis-rot y-axis-rot z-axis-rot
/define boundary-conditions wall car_tyrerear yes motion-bc-moving no no no yes no no 0 no 0.5 no wheel-rot-speed x-origin-tyrerear y-origin-tyrerear z-origin-tyrerear x-axis-rot y-axis-rot z-axis-rot

;;save reports to csv
(ti-menu-load-string (format #f "/solve report-files edit straightline-force file-name report-~a-~a-~02d.csv" fileName study factor))

;;write case before solve just in case - not for iteration we already have a backup
;;(ti-menu-load-string (format #f "file write-case before-solved-~a-~a-~02d.cas.gz" fileName study factor))

;;initialize
/solve initialize hyb-initialization

;;include data qauntities - no way to seelct all so listed all here :(
file data-file-options yes abs-angular-coordinate mesh-x-velocity absolute-pressure mesh-y-velocity adaption-curvature mesh-z-velocity adaption-function orthogonal-quality adaption-iso-value partition-neighbors adaption-space-gradient pressure angular-coordinate pressure-coefficient axial-coordinate production-of-k axial-velocity radial-coordinate boundary-cell-dist radial-velocity boundary-normal-dist rel-tangential-velocity boundary-volume-dist rel-total-pressure cell-children rel-velocity-magnitude cell-element-type relative-velocity-angle cell-equiangle-skew relative-x-velocity cell-equivolume-skew relative-y-velocity cell-id relative-z-velocity cell-partition-active skin-friction-coef cell-partition-stored strain-rate-mag cell-refine-level tangential-velocity cell-reynolds-number total-pressure cell-surface-area turb-diss-rate cell-type turb-intensity cell-volume turb-kinetic-energy cell-volume-change turb-reynolds-number-rey cell-wall-distance velocity-angle cell-warp velocity-magnitude cell-weight viscosity-eff cell-zone viscosity-lam curv-corr-fr viscosity-ratio density viscosity-turb density-all vorticity-mag dp-dx wall-shear dp-dy wall-temp-in-surf dp-dz wall-temp-out-surf dx-velocity-dx x-coordinate dx-velocity-dy x-face-area dx-velocity-dz x-velocity dy-velocity-dx x-vorticity dy-velocity-dy x-wall-shear dy-velocity-dz y-coordinate dynamic-pressure y-face-area dz-velocity-dx y-plus dz-velocity-dy y-star dz-velocity-dz y-velocity existing-value y-vorticity face-area-magnitude y-wall-shear face-handedness z-coordinate helicity z-face-area interface-overlap-fraction z-velocity mark-poor-elements z-vorticity mass-imbalance z-wall-shear q

;;solve
/solve iterate number-of-iterate

;;lift drag COP force reports for all because why not
(ti-menu-load-string (format #f "report forces wall-forces no car_frontwing car_rearwing car_undertray car_nosecone car_suspension car_system car_tyrefront car_tyrerear , 0 -1 0 yes downforce-~a-~a-~02d.csv" fileName study factor))
(ti-menu-load-string (format #f "report forces wall-forces no car_frontwing car_rearwing car_undertray car_nosecone car_suspension car_system car_tyrefront car_tyrerear , 0 0 -1 yes drag-~a-~a-~02d.csv" fileName study factor))
(ti-menu-load-string (format #f "report forces pressure-center no car_frontwing car_rearwing car_undertray car_nosecone car_suspension car_system car_tyrefront car_tyrerear , no yes 0 yes COP-Y-~a-~a~02d.csv"fileName study factor))

;----------SET SCREENSHOT OPTIONS----------
//display/set/colors/color-scheme gray-gradient
display/set/picture/use-window-resolution? no
display/set/picture/x-resolution 1920
display/set/picture/y-resolution 1080
display/set/picture/invert-background? no
;
;----------SAVE REPORT PLOT WINDOWS----------
//display/set-window 1
display/save-picture "[IMG] 00 - Scaled Residuals - 80Kmh.jpg"
display/set-window 2
display/save-picture "[IMG] 01 - Lift and Drag - 80Kmh.jpg"

;summary of sim
(ti-menu-load-string (format #f "report summary yes fluent-solving-~a-~a-~02d-report.csv" fileName study factor))
/report system proc-stats

;write case and data files
/file/export/cdat-for-cfd-post-&-ensight solved-80KmH (*) (*) (*) yes yes

;stop transcript
file stop-transcript
;exit fluent
exit
ok
;exit fluent
exit
ok
exit
ok
ok